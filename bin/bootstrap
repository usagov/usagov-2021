#!/bin/bash
set -e

usage="
$0: Does 'docker compose run' to automatically run scripts/bootstrap.sh

Usage:
   $0 -h

Options:
-h:            show help and exit
"

PREAMBLE=$( pwd -P )/bin/includes/preamble.sh
if [ -f "$PREAMBLE" ]; then
  # shellcheck source=bin/includes/preamble.sh
  . "$PREAMBLE"
else
   echo Cannot find preamble at "$PREAMBLE"
   exit 1
fi

# we do not directly call bootstrap
# rather, bootstrap is automatically triggered
# during container startup. drupal config update runs only when
# the container is declared to be index 0
docker compose run \
  --rm \
  --workdir /var/www \
  -e CF_INSTANCE_INDEX=0 \
  cms \
  echo "Done running bootstrap"
