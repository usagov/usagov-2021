#!/bin/bash

usage="
$0: Pull public files from the current targeted space's S3 bucket to a temporary local directory.

Usage:
   $0 -h
   $0 localdir

Options:
-h:            show help and exit
localdir:      local directory to pull files to
"

PREAMBLE=$(sed -E 's/bin\/.*\/includes/bin\/includes/g' <<< "$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )/includes/preamble.sh")
if [ -f "$PREAMBLE" ]; then
  # shellcheck source=bin/includes/preamble.sh
  . "$PREAMBLE"
else
   echo Cannot find preamble at "$PREAMBLE"
   exit 1
fi

localdir="$1"

# TODO: check for localdir; should be an emtpy directory. Or, create one!

printf "Downloading S3 files to $localdir ..."

# Get access
source bin/cloudgov/get-s3-access storage >/dev/null 2>&1

aws s3 sync s3://$S3_BUCKET/cms/public/ $localdir \
    --exclude "php/*" \
    --exclude "css/*" \
    --exclude "js/*"
