#!/bin/bash

if ! command -v cf &> /dev/null
then
    echo "CF : the cloud foundry client could not be found and is required"
    exit
fi

SCRIPTDIR=$(dirname "$0")

STARTSPACE=$( cf target | grep space: | awk '{ print $2 }')
APP_SPACE=${1:-$STARTSPACE}

$SCRIPTDIR/space dev

cf create-service cloud-gov-service-account space-deployer cci-${APP_SPACE}-service-account
cf create-service-key cci-${APP_SPACE}-service-account cci-${APP_SPACE}-service-key
cf service-key cci-${APP_SPACE}-service-account cci-${APP_SPACE}-service-key
