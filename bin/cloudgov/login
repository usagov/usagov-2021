#!/bin/bash
set -e

usage="
$0: Logs in to cloud.gov

Usage:
   $0 -h
   $0 USER PASS
   $0 USER PASS SPACE

Options:
-h:            show help and exit
USER:          Provisioned username (from env.local)
PASS:          Provisioned password (from env.local)
SPACE:         default space to login to (default: dev)
"

PREAMBLE=$(sed -E 's/bin\/.*\/includes/bin\/includes/g' <<< "$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )/includes/preamble.sh")
if [ -f "$PREAMBLE" ]; then
  # shellcheck source=bin/includes/preamble.sh
  . "$PREAMBLE"
else
   echo Cannot find preamble at "$PREAMBLE"
   exit 1
fi

# can directly pass in a user and pass parameter
USER=$1
PASS=$2
SPACE=${3:-dev}

# if only passing in a single param, convert space name into user/pass
if [ "$#" -eq 0 ]; then
  USER=$CF_SERVICE_USER
  PASS=$CF_SERVICE_PASS
fi

if [[ -n "$USER" ]] && [[ -n "$PASS" ]]; then
    cf login -a https://api.fr.cloud.gov -u $USER -p $PASS -s $SPACE
else
    cf login -a https://api.fr.cloud.gov --sso
fi
