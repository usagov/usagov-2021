#!/bin/env bash

# we might be running in circleci
if [ -f /home/circleci/project/env.local ]; then
  . /home/circleci/project/env.local
fi
# we might be running from a local dev machine
SCRIPT_DIR="$(dirname "$0")"
if [ -f $SCRIPT_DIR/env.local ]; then
  . $SCRIPT_DIR/env.local
fi
if [ -f ./env.local ]; then
  . ./env.local
fi
if [ -f $SCRIPT_DIR/../deploy/includes ]; then
  . $SCRIPT_DIR/../deploy/includes
else
   echo Cannot find $SCRIPT_DIR/../deploy/includes
   exit 1
fi

startorg=$(cf target | grep org: | awk '{ print $2 }')

SPACE=${1:-please-provide-space-name-as-first-argument}
SPACE=$(echo "$SPACE" | tr '[:upper:]' '[:lower:]')
assertCurSpace $SPACE
shift

. $SCRIPT_DIR/get-s3-access

$echo touch /tmp/.s3keep
for folder in $(s3FoldersList); do 
    $echo aws s3 cp /tmp/.s3keep s3://$S3_BUCKET/$folder/.s3keep
done
$echo rm /tmp/.s3keep
