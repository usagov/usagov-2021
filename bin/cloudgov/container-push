#!/bin/bash

usage="
$0: Pushes built cms and waf containers to Docker Hub.

Usage:
   $0 -h

Options:
-h:            show help and exit
DOCKERUSER:    Docker Hub username (default: gsatts [don't change this])
DOCKERREPO:    Docker Hub repo (default: usagov-2021 [don't change this])
CONTAINERTAG:  Git tag of the container being created
CONTAINERTAG2: Optional tag label

NOTES:
Arguments come from environment.
"

PREAMBLE=$( pwd -P )/bin/includes/preamble.sh
if [ -f "$PREAMBLE" ]; then
  # shellcheck source=bin/includes/preamble.sh
  . "$PREAMBLE"
else
   echo Cannot find preamble at "$PREAMBLE"
   exit 1
fi

DOCKERUSER=${DOCKERUSER:-gsatts}
DOCKERREPO=${DOCKERREPO:-usagov-2021}

CONTAINERTAG=${1}
CONTAINERTAG2=${2}

if [ -z "$CONTAINERTAG" ]
then
      echo "Must specify a container tag to push"
      exit 1;
fi;

echo "docker push $DOCKERUSER/$DOCKERREPO:cms-$CONTAINERTAG"
docker push $DOCKERUSER/$DOCKERREPO:cms-$CONTAINERTAG
if [ -n "$CONTAINERTAG2" ]
then
    echo "docker push $DOCKERUSER/$DOCKERREPO:cms-$CONTAINERTAG2"
    docker push $DOCKERUSER/$DOCKERREPO:cms-$CONTAINERTAG2
fi

echo "docker push $DOCKERUSER/$DOCKERREPO:waf-$CONTAINERTAG"
docker push $DOCKERUSER/$DOCKERREPO:waf-$CONTAINERTAG
if [ -n "$CONTAINERTAG2" ]
then
    echo "docker push $DOCKERUSER/$DOCKERREPO:waf-$CONTAINERTAG2"
    docker push $DOCKERUSER/$DOCKERREPO:waf-$CONTAINERTAG2
fi
