#!/bin/bash
set -e

usage="
$0: Builds composer container and runs fix script.

Usage:
   $0 -h

Options:
-h:            show help and exit
"
if [[ "$1" == "-h" ]]; then
    echo "${usage}"
    exit 1
fi

docker compose run \
  --rm \
  --no-deps \
  --workdir /var/www \
  composer \
  composer "$@" --ignore-platform-reqs

docker compose run \
 -e BUID=$(id -u) \
 -e BGID=$(id -g) \
 --rm --no-deps --workdir /var/www  \
 -u root composer /var/www/bin/fix-perms-in-composer
