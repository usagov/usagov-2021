#!/bin/sh

### Create s3 snapshot backup of current environment's static site and database

### 3 required arguments:
### $1 - Desired environment (must be current environment - this is to confirm intent to act in the current environment)
### $2 - Desired branch (must be current branch - this is to confirm intent)
### $3 - Tag Suffix (for example pre_deploy or post_deploy)

####
#### Static Site Backup
####
bin/snapshot-backups/stw $1 $2 $3 site-snapshot-create
bin/snapshot-backups/stw $1 $2 $3 site-snapshot-download

# --- Not needed unless local changes are to be pushed to the working env
# --- (the tag will need to be provided in this case, rather than generated by stw):
# bin/snapshot-backups/site-folder-push-to-snapshot <tag>

bin/snapshot-backups/site-snapshot-list

####
#### DB Backup
####
bin/snapshot-backups/stw $1 $2 $3 db-dump-download
bin/snapshot-backups/stw $1 $2 $3 db-dump-push-to-snapshot

# --- not needed unless retreiving previous db snapshot
#bin/snapshot-backups/db-snapshot-download <tag>

bin/snapshot-backups/db-list
