#!/bin/sh

SCRIPT_DIR="$(dirname $(readlink -f "$0"))"
if [ -f $SCRIPT_DIR/includes ]; then
  . $SCRIPT_DIR/includes
fi

# Make sure git is up to date
echo "Updating git perma-branches: dev, stage, prod" | toLogs

git fetch --all -q
git checkout dev -q
git pull -q
git checkout stage -q
git pull -q
git checkout prod -q
git pull -q

DEPLOY_BRANCH=${DEPLOY_BRANCH:-}
if [ -n "$DEPLOY_BRANCH" ] && [ ! "$DEPLOY_BRANCH" == "dev" ] && [ ! "$DEPLOY_BRANCH" == "stage" ] && [ ! "$DEPLOY_BRANCH" == "prod" ]; then
  git checkout $DEPLOY_BRANCH -q
  git pull -q
fi

MERGE_BRANCH=${MERGE_BRANCH:-}
if [ -n "$MERGE_BRANCH" ] && [ ! "$MERGE_BRANCH" == "$DEPLOY_BRANCH" ] && [ ! "$MERGE_BRANCH" == "dev" ] && [ ! "$MERGE_BRANCH" == "stage" ] && [ ! "$MERGE_BRANCH" == "prod" ]; then
  git checkout $MERGE_BRANCH -q
  git pull -q
fi

popbranch

return 0
