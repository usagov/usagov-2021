#!/bin/bash

isnum_Case() { case ${1#[-+]} in ''|.|*[!0-9.]*|*.*.*) return 1;; esac ;}

if isnum_Case "$1"
then
    LOCAL_PORT=$1
    LOCAL_FILE=${2:-usagov.sql}
else
    LOCAL_PORT=3306
    LOCAL_FILE=${1:-usagov.sql}
fi

docker compose exec \
  database \
  /bin/bash -c "sed -e 's/utf8mb4_0900_ai_ci/utf8mb4_unicode_ci/g' /app/$LOCAL_FILE | mysql -hlocalhost -P$LOCAL_PORT -uroot -pmysql drupal "
