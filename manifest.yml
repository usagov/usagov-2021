---
default_config: &defaults
  # buildpacks:
    # We need the "apt" buildpack to install a MySQL client for Drush; see apt.yml
    # - https://github.com/cloudfoundry/php-buildpack.git#v4.4.40
  disk_quota: 512M
  timeout: 180
  services:
    - database # cf create-service aws-rds shared-mysql database
    - secrets  # cf create-user-provided-service secrets -p '{
               # "CRON_KEY": ...
               # "HASH_SALT": ...
               # "ROOT_USER_NAME": ...,
               # "ROOT_USER_PASS": ...,
               # }'
    - storage  # cf create-service s3 basic-sandbox storage

applications:
- name: cms
  docker:
    image: ednark/usagov-2021:cms-dan
  memory: 256M
  disk_quota: 1G
  timeout: 180
  services:
    - database
    - secrets
    - storage
  instances: 1
  random-route: true
    #- name: web
    #  docker:
    #    image: ednark/usagov-2021:web-latest
    #  memory: 128M
    #  disk_quota: 1G
    #  timeout: 180
    #  services:
    #    - secrets
    #    - storage
    #  instances: 1
    #  random-route: true
- name: test-route-service-app
  docker:
    image: skstarne/usagov-2021:waf-latest
  instances: 1
  disk_quota: 1G
  memory: 128M
  health-check-type: http
  health-check-http-endpoint: /_route-service-health
  env:
    APP_NAME: test-route-service-app
    BLOCKED_NAME: USAGov
    ALLOWED_IPS: |
      allow 50.81.160.164;
    TEST_COMMENT: |
      allow 50.81.160.164;
      allow 70.230.121.217;
      allow 100.36.151.190;

# - name: cronish
#   <<: *defaults
#   no-route: true
#   command: ./cronish.sh
#   health-check-type: process
#   memory: 128M
