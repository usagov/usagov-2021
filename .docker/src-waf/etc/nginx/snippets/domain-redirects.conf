# Redirects from other domains to www.usa.gov
# Reminder: ~* is case-insensitive match

  ## Redirect usa.gov to www.usa.gov; preserve path
  if ($cf_forwarded_host ~* ^usa\.gov$) {
    return 301 https://www.usa.gov$request_uri;
  }

  ## Redirect these hostnames to www.usa.gov; don't preserve paths
  if ($cf_forwarded_host ~* ^(www\.)?consumeraction\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^(www\.)?firstgov\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^(www\.)?us\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^(www\.)?usagov\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^(www\.)?usgovernment\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^notice.usa\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^notifications.usa\.gov$) {
    return 301 https://www.usa.gov;
  }
  if ($cf_forwarded_host ~* ^answers.usa\.gov$) {
    return 301 https://www.usa.gov;
  }

  ## Redirect businessusa.gov to business.usa.gov; don't preserve paths
  if ($cf_forwarded_host ~* ^(www\.)?businessusa\.gov$) {
    return 301 https://business.usa.gov;
  }

  ## Redirect all old business.usa.gov URLs to new locations on usa.gov (in external file)
  if ($cf_forwarded_host ~* ^business.usa\.gov$) {
    # server_name business.usa.gov;
    # include rewrites-bizusa.conf;
    # FIXME: 
    return 301 https://business.usa.gov;
  }

  ## Redirect faq.gov to page on www.usa.gov
  if ($cf_forwarded_host ~* ^(www\.)?faq\.gov$) {
    return https://www.usa.gov/Contact/Faq.shtml;
    # FIXME: It was something like this:
    # https://web.archive.org/web/20100723182602/https://www.usa.gov/Contact/Faq.shtml
  }

  ## Redirect info.gov to page on www.usa.gov 
  if ($cf_forwarded_host ~* ^(www\.)?info\.gov$) {
    return 301 https://www.usa.gov/contact;
  }

  ## Redirect tellus.usa.gov to page on www.usa.gov
  if ($cf_forwarded_host ~* ^(www\.)?tellus\.usa\.gov$) {  
    # FIXME
    # Back in 2017, this was about passports: https://web.archive.org/web/20170427141756/www.usa.gov/tell-us
    return 301 https://www.usa.gov/tell-us;
  }
  if ($cf_forwarded_host ~* ^tell-us\.usa\.gov$) {  
    # FIXME
    # Back in 2017, this was about passports: https://web.archive.org/web/20170427141756/www.usa.gov/tell-us
    return 301 https://www.usa.gov/tell-us;
  }

  ## Redirect forms.gov to page on www.usa.gov
  if ($cf_forwarded_host ~* ^(www\.)?forms\.gov$) {
    # FIXME no longer exists. 
    return 301 https://www.usa.gov/forms?utm_source=forms_gov&utm_medium=USAGov_Redirect&utm_campaign=Dec_2019_launch;
  }

  ## Redirect vote to strip out www; preserve path
  if ($cf_forwarded_host ~* ^(www\.)?vote(\.usa)?\.gov$) {  
    return 301 https://vote.gov$request_uri;
  }

  ## Redirect kids.gov to kids.usa.gov; preserve paths
  if ($cf_forwarded_host ~* ^(www\.)?kids\.gov$) {    
    return 301 https://kids.usa.gov$request_uri;
    # FIXME: then rewrites further.
    ## Redirect all old kids.usa.gov URLs to new locations on usa.gov (in external file)    
    # include rewrites-kids.conf;
  }

  ## Redirect gobierno sites to www.usa.gov/es/[path]. cms app's redirects will sort them further.
  if ($cf_forwarded_host ~* ^(www\.)?gobierno(\.usa)?\.gov$) {
    return 301 https://www.usa.gov/es$request_uri;
  }
  if ($cf_forwarded_host ~* ^(m\.)?gobierno(usa)?\.gov$) {
    return 301 https://www.usa.gov/es$request_uri;
  }
  if ($cf_forwarded_host ~* ^(respuestas\.)?gobierno(usa)?\.gov$) {
    return 301 https://www.usa.gov/es$request_uri;
  }

  if ($cf_forwarded_host ~* ^blog\.gobiernousa\.gov$) {
    return 301 https://www.usa.gov/es;
  }

  if ($cf_forwarded_host ~* ^apps\.gobiernousa\.gov$) {
    # FIXME: 404. Looks ancient
    # https://web.archive.org/web/20230207221709/https://www.usa.gov/espanol/apps-moviles
    return 301 https://www.usa.gov/es/apps-moviles;
  }

  ## Redirect challenge(s).gov to www.challenge.gov
  if ($cf_forwarded_host ~* ^challenge\.gov$) {
    return 301 https://www.challenge.gov$request_uri;
  }
  if ($cf_forwarded_host ~* ^(www\.)?challenges\.gov$) {  
    return 301 https://www.challenge.gov$request_uri;
  }

  ## Redirect legacy mobile sites
  if ($cf_forwarded_host ~* ^m\.gsa\.gov$) {  
    return 301 https://www.gsa.gov;
  }
  if ($cf_forwarded_host ~* ^m\.usa\.gov$) {  
    return 301 https://www.usa.gov$request_uri;
  }

  ## Redirect USA.gov subdomains to their new locations
  if ($cf_forwarded_host ~* ^apps\.usa\.gov$) {    
    # FIXME 404
    return 301 https://www.usa.gov/mobile-apps;
  }

  ## Redirect old GSA sites to their new locations; preserve paths
  # FIXME: looks like we don't plan to serve gsa.gov
  # server {
  #   listen 443 ssl http2;
  #   listen [::]:443 ssl http2;
  #   server_name gsa.gov;
  #   return 301 https://www.gsa.gov$request_uri;
  # }

  if ($cf_forwarded_host ~* ^registry\.usa\.gov$) {    
    return 301 https://github.com/usagov/Social-Media-Registry-API-Documentation;
  }

  if ($cf_forwarded_host ~* ^publications\.usa\.gov$) {    
    return 301 https://connect.usa.gov/publications;
  }

  if ($cf_forwarded_host ~* ^(www\.)?promotions\.usa\.gov$) {
    # FIXME need rewrites
    # include rewrites-promos.conf;
    return 301 https://connect.usa.gov/publications;
  }

  if ($cf_forwarded_host ~* ^www\.feedback\.usa\.gov$) {
    return 301 https://feedback.usa.gov$request_uri;
  }

  if ($cf_forwarded_host ~* ^(www\.)?my\.usa\.gov$) {
    return 301 https://login.gov;
  }

  if ($cf_forwarded_host ~* ^400yaahc\.gov$) {
    return 301 https://www.400yaahc.gov$request_uri;
  }

  if ($cf_forwarded_host ~* ^pbrb\.gov$) {
    # FIXME: not in DNS requests. 
    return 301 https://www.pbrb.gov$request_uri;
  }

  if ($cf_forwarded_host ~* ^sffeb\.us$) {
    # FIXME: not in DNS requests. 
    return 301 https://www.sffeb.us$request_uri;
  }

  ## Redirect all old fedidcard.gov URLs to new locations on gsa.gov (in external file)
  if ($cf_forwarded_host ~* ^(www\.)?fedidcard\.gov$) {
    return 301 https://www.gsa.gov/technology/technology-purchasing-programs/federal-credentialing-services;
    # FIXME need rewrites
    # Top-level goes to https://www.gsa.gov/technology/technology-purchasing-programs/federal-credentialing-services
    # include rewrites-fedidcard.conf;
  }
